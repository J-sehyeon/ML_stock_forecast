from datetime import datetime
minute_key = datetime.now().strftime("%Y%m%d_%H%M")
import pandas as pd

input = "0|H0STASP0|001|000660^152522^A^959000^960000^961000^0^0^0^0^0^0^0^958000^957000^956000^0^0^0^0^0^0^0^3893^7010^4960^0^0^0^0^0^0^0^12^76^51^0^0^0^0^0^0^0^15863^139^0^0^959000^259810^259810^10000^2^1.05^3184369^0^0^0^0^0^0^0^0"
in4 = "0|H0STCNT0|004|005930^104041^203000^2^3000^1.50^202428.46^202500^205000^201000^203500^203000^7^10014929^2027304381000^37847^83979^46132^105.19^4162597^4378796^5^0.44^35.69^090008^2^500^090051^5^-2000^091355^2^2000^20260225^20^N^294776^107529^1082944^1257868^0.17^9513298^105.27^0^^202500^005930^104041^203500^2^3500^1.75^202428.46^202500^205000^201000^203500^203000^1^10014930^2027304584500^37847^83980^46133^105.19^4162597^4378797^1^0.44^35.69^090008^2^1000^090051^5^-1500^091355^2^2500^20260225^20^N^294776^107529^1082944^1257868^0.17^9513298^105.27^0^^202500^005930^104041^203500^2^3500^1.75^202428.46^202500^205000^201000^203500^203000^6^10014936^2027305805500^37847^83981^46134^105.19^4162597^4378803^1^0.44^35.69^090008^2^1000^090051^5^-1500^091355^2^2500^20260225^20^N^294776^107529^1082944^1257868^0.17^9513298^105.27^0^^202500^005930^104041^203500^2^3500^1.75^202428.46^202500^205000^201000^203500^203000^5^10014941^2027306823000^37847^83982^46135^105.19^4162597^4378808^1^0.44^35.69^090008^2^1000^090051^5^-1500^091355^2^2500^20260225^20^N^294769^107522^1082938^1257865^0.17^9513298^105.27^0^^202500"
in1 = "0|H0STASP0|001|005930^104041^0^203500^204000^204500^205000^205500^206000^206500^207000^207500^208000^203000^202500^202000^201500^201000^200500^200000^199900^199800^199700^294764^142499^52865^90605^53159^101467^95839^83773^68567^99395^107765^82451^125950^121715^239354^132123^369226^39552^20847^19098^1082933^1258081^0^0^0^0^1472613^-200000^5^-100.00^10014941^-5^216^0^0^0^203250^0^0"
data = in4.split('|')[3]
print(type(data[:6]))

now = datetime.now()
print(now.strftime("%H:%M:%S"))

columns = [
        "MKSC_SHRN_ISCD", "BSOP_HOUR", "HOUR_CLS_CODE",
        "ASKP1", "ASKP2", "ASKP3", "ASKP4", "ASKP5",
        "ASKP6", "ASKP7", "ASKP8", "ASKP9", "ASKP10",
        "BIDP1", "BIDP2", "BIDP3", "BIDP4", "BIDP5",
        "BIDP6", "BIDP7", "BIDP8", "BIDP9", "BIDP10",
        "ASKP_RSQN1", "ASKP_RSQN2", "ASKP_RSQN3", "ASKP_RSQN4", "ASKP_RSQN5",
        "ASKP_RSQN6", "ASKP_RSQN7", "ASKP_RSQN8", "ASKP_RSQN9", "ASKP_RSQN10",
        "BIDP_RSQN1", "BIDP_RSQN2", "BIDP_RSQN3", "BIDP_RSQN4", "BIDP_RSQN5",
        "BIDP_RSQN6", "BIDP_RSQN7", "BIDP_RSQN8", "BIDP_RSQN9", "BIDP_RSQN10",
        "TOTAL_ASKP_RSQN", "TOTAL_BIDP_RSQN", "OVTM_TOTAL_ASKP_RSQN", "OVTM_TOTAL_BIDP_RSQN",
        "ANTC_CNPR", "ANTC_CNQN", "ANTC_VOL", "ANTC_CNTG_VRSS", "ANTC_CNTG_VRSS_SIGN",
        "ANTC_CNTG_PRDY_CTRT", "ACML_VOL",
        "dummy1", "dummmy2", "dummy3", "dummy4", "dummy5", "dummy6", "dummy7", "dummy8"
]   # 59개
from io import StringIO
if input[0] in ["0", "1"]:
    d1 = input.split("|")
    if len(d1) < 4:
        raise ValueError("data not found...")

    tr_id = d1[1]            
  
    d = d1[3]

    code = d[:6]        # 종목 코드 저장
    df = pd.read_csv(       # 배치 단위로 들어오는 데이터 처리 가능
        StringIO(d), header=None, sep="^", names=columns, dtype=object
        )
    show_result = True
r = d.split("^")
print(len(r))
print(df)
print(len(columns))
d = data.split("^")
print(len(d))
print(d)


columns = [
        "MKSC_SHRN_ISCD", "STCK_CNTG_HOUR", "STCK_PRPR", "PRDY_VRSS_SIGN",
        "PRDY_VRSS", "PRDY_CTRT", "WGHN_AVRG_STCK_PRC", "STCK_OPRC",
        "STCK_HGPR", "STCK_LWPR", "ASKP1", "BIDP1", "CNTG_VOL", "ACML_VOL",
        "ACML_TR_PBMN", "SELN_CNTG_CSNU", "SHNU_CNTG_CSNU", "NTBY_CNTG_CSNU",
        "CTTR", "SELN_CNTG_SMTN", "SHNU_CNTG_SMTN", "CCLD_DVSN", "SHNU_RATE",
        "PRDY_VOL_VRSS_ACML_VOL_RATE", "OPRC_HOUR", "OPRC_VRSS_PRPR_SIGN",
        "OPRC_VRSS_PRPR", "HGPR_HOUR", "HGPR_VRSS_PRPR_SIGN", "HGPR_VRSS_PRPR",
        "LWPR_HOUR", "LWPR_VRSS_PRPR_SIGN", "LWPR_VRSS_PRPR", "BSOP_DATE",
        "NEW_MKOP_CLS_CODE", "TRHT_YN", "ASKP_RSQN1", "BIDP_RSQN1",
        "TOTAL_ASKP_RSQN", "TOTAL_BIDP_RSQN", "VOL_TNRT",
        "PRDY_SMNS_HOUR_ACML_VOL", "PRDY_SMNS_HOUR_ACML_VOL_RATE",
        "HOUR_CLS_CODE", "MRKT_TRTM_CLS_CODE", "VI_STND_PRC"
]
print(len(columns))